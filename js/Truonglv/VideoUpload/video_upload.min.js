!function(i,t,e){XenForo.TVU_VideoUploadButton=function(t){this.__construct(t)},XenForo.TVU_VideoUploadButton.prototype={__construct:function(t){this.$button=t,this.$attachUploader=i(".AttachmentUploader");var e=t.data("extensions").toLowerCase().split(",");this.allowExtensions=[];for(var o=0;o<e.length;o++)this.allowExtensions.push(i.trim(e[o]));this.config={target:"misc/tvu-video-upload",query:{_xfToken:XenForo._csrfToken,_xfResponseType:"json",content_data:JSON.stringify(t.data("payload")),hash:t.data("hash")},chunkSize:t.data("chunk"),maxFiles:1,testChunks:!1,forceChunkSize:!0,simultaneousUploads:t.data("simultaneousuploads")||3,readFileFn:function(t,e,o,i,n){var a="slice";t.file.slice?a="slice":t.file.mozSlice?a="mozSlice":t.file.webkitSlice&&(a="webkitSlice"),i||(i=""),n.readFinished(t.file[a](e,o,i))},allowDuplicateUploads:!0},this.flow=new Flow(this.config),this.flow.assignBrowse(this.$button,!1,!1,{accept:"."+t.data("extensions").toLowerCase().replace(/,/g,",.")}),this.flow.on("fileAdded",i.context(this,"onFileAdded")),this.flow.on("fileError",i.context(this,"onFileError")),this.flow.on("fileProgress",i.context(this,"onFileProgress")),this.flow.on("complete",i.context(this,"onComplete")),this.flow.on("filesSubmitted",i.context(this,"onFilesSubmitted")),this._file=null},onFilesSubmitted:function(){this.flow.upload()},onComplete:function(){if(null!==this._file&&this._file._prevUploadedSize===this._file.size){var t,e=this,o=this._file;t={flowTotalChunks:o.chunks.length,flowFilename:o.name,flowTotalSize:o.size,is_completed:1,content_data:this.config.query.content_data,hash:this.config.query.hash},XenForo.ajax(this.config.target,t,function(t){XenForo.hasResponseError(t)?e.$attachUploader.trigger({type:"AttachmentUploadError",file:o,message:e.$button.data("file-error"),ajaxData:{error:[e.$button.data("file-error")]},flow:e.flow}):e.$attachUploader.trigger({type:"AttachmentUploaded",file:o,ajaxData:t,flow:e.flow})}).always(function(){e.disableUpload(!1),e.flow.removeFile(e._file),e._file=null})}else this.disableUpload(!1)},onFileAdded:function(t){this.disableUpload(!0),this._file=t;var e=i.Event("AttachmentQueued");e.file=t,e.flow=this.flow,e.isImage=!1,this.$attachUploader.trigger(e)},onFileProgress:function(t){t.id=t.uniqueIdentifier,this.$attachUploader.trigger({type:"AttachmentUploadProgress",file:t,bytes:Math.round(t.progress()*t.size),flow:this.flow})},onFileError:function(t,e){this.$attachUploader.trigger({type:"AttachmentUploadError",file:t,message:e,ajaxData:{error:[this.$button.data("file-error")]},flow:this.flow}),setTimeout(function(){_this.disableUpload(!1)},1e3)},disableUpload:function(t){var e=t?"addClass":"removeClass";this.$button.prop("disabled",t)[e]("disabled")}},XenForo.TVU_AttachmentInserter=function(n){n.click(function(t){var e,o;if(t.preventDefault(),o="[ATTACH=video]"+n.data("attachmentid")+"[/ATTACH]",e=XenForo.getEditorInForm(n.closest("form"),":not(.NoAttachment)"))if(e.$editor){e.insertHtml(o);var i=e.$editor.data("xenForoElastic");i&&(setTimeout(function(){i()},250),setTimeout(function(){i()},1e3))}else e.val(e.val()+o)})},XenForo.TVU_VideoSetup=function(t){videojs(t.attr("id"),{fluid:!0})},XenForo.register(".TVU_VideoUploadButton","XenForo.TVU_VideoUploadButton"),XenForo.register(".TVU_AttachmentInserter","XenForo.TVU_AttachmentInserter"),XenForo.register(".TVU_VideoSetup","XenForo.TVU_VideoSetup")}(jQuery,window,document);
//# sourceMappingURL=video_upload.min.js.map