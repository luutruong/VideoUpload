!function(a,e,t){XenForo.TVU_VideoUploadButton=function(e){this.__construct(e)},XenForo.TVU_VideoUploadButton.prototype={__construct:function(e){this.$button=e,this.$attachUploader=a(".AttachmentUploader");var t=e.data("extensions").toLowerCase().split(",");this.allowExtensions=[];for(var o=0;o<t.length;o++)this.allowExtensions.push(a.trim(t[o]));this.config={target:"misc/tvu-video-upload",query:{_xfToken:XenForo._csrfToken,_xfResponseType:"json",content_data:JSON.stringify(e.data("payload")),hash:e.data("hash")},chunkSize:e.data("chunk"),maxFiles:1,testChunks:!1,forceChunkSize:!0,simultaneousUploads:e.data("simultaneousuploads")||3},this.resumable=new Resumable(this.config),this.resumable.assignBrowse(this.$button),this.resumable.on("fileAdded",a.context(this,"onFileAdded")),this.resumable.on("fileError",a.context(this,"onFileError")),this.resumable.on("fileProgress",a.context(this,"onFileProgress")),this.resumable.on("complete",a.context(this,"onComplete")),this._file=null},onComplete:function(){if(null!==this._file&&this._file.isComplete()){var e=a.extend(this.config.query,{resumableTotalChunks:this._file.chunks.length,resumableFilename:this._file.fileName,resumableTotalSize:this._file.size,is_completed:1}),t=this;XenForo.ajax(this.config.target,e,function(e){if(t.disableUpload(!1),XenForo.hasResponseError(e))return t.$attachUploader.trigger({type:"AttachmentUploadError",file:t._file.file,message:t.$button.data("file-error"),ajaxData:{error:[t.$button.data("file-error")]}}),void t.resumable.removeFile(t._file);t.$attachUploader.trigger({type:"AttachmentUploaded",file:t._file.file,ajaxData:e})})}},onFileAdded:function(t){var e=t.fileName.substr(t.fileName.lastIndexOf(".")+1).toLowerCase(),o=this;if(-1===this.allowExtensions.indexOf(e))return XenForo.alert(this.$button.data("error")),void this.resumable.removeFile(t);this.disableUpload(!0),this._file=t;var i=a.Event("AttachmentQueued");i.file=t.file,i.isImage=!1,this.$attachUploader.trigger(i),this.resumable.upload(),a(".AttachmentCanceller").on("click",function(e){a(e.target).closest(".AttachedFile").attr("id")===t.uniqueIdentifier&&(o._file=null,t.cancel(),o.disableUpload(!1),o.resumable.removeFile(t))})},onFileProgress:function(e,t){void 0!==t&&this.$attachUploader.trigger({type:"AttachmentUploadProgress",file:e.file,bytes:e.progress()*e.file.size})},onFileError:function(e,t){var o,i=this;try{o=JSON.parse(t)}catch(e){}this.$attachUploader.trigger({type:"AttachmentUploadError",file:e.file,message:this.$button.data("file-error"),ajaxData:o||{error:[this.$button.data("file-error")]}}),this.resumable.removeFile(e),this._file=null,setTimeout(function(){i.disableUpload(!1)},1e3)},disableUpload:function(e){var t=e?"addClass":"removeClass";this.$button.prop("disabled",e)[t]("disabled")}},XenForo.TVU_AttachmentInserter=function(a){a.click(function(e){var t,o;if(e.preventDefault(),o="[ATTACH=video]"+a.data("attachmentid")+"[/ATTACH]",t=XenForo.getEditorInForm(a.closest("form"),":not(.NoAttachment)"))if(t.$editor){t.insertHtml(o);var i=t.$editor.data("xenForoElastic");i&&(setTimeout(function(){i()},250),setTimeout(function(){i()},1e3))}else t.val(t.val()+o)})},XenForo.TVU_VideoSetup=function(e){videojs(e.attr("id"),{fluid:!0})},XenForo.register(".TVU_VideoUploadButton","XenForo.TVU_VideoUploadButton"),XenForo.register(".TVU_AttachmentInserter","XenForo.TVU_AttachmentInserter"),XenForo.register(".TVU_VideoSetup","XenForo.TVU_VideoSetup")}(jQuery,window,document);
//# sourceMappingURL=video_upload.min.js.map